define(["require","exports","module","jquery"],function(n){function e(n,e){function o(){function n(){a(l.url,{action:"listenIsBegin",name:l.name},s("listenIsBegin"),function(e){u(e),"ok"==e.ret?(i(),r(),l.subscriber.notifyBegin()):m=setTimeout(n,l.interval)})}m=setTimeout(n,l.interval)}function r(){clearTimeout(m)}function i(){function n(){a(l.url,{action:"listenCommand",name:l.name,camp:l.camp},s("listenCommand"),function(n){u(n),"ok"==n.ret?"move"==n.cmd?l.subscriber.notifyMove(n.posA,n.posB):"regretask"==n.cmd?l.subscriber.notifyRegretAsk():"regretans"==n.cmd&&l.subscriber.notifyRegretAns(n.ans):"nogame"==n.ret&&(r(),c(),l.subscriber.notifyGameOver())})}f=setInterval(n,l.interval)}function c(){clearInterval(f)}function a(n,e,o,r){t.ajax({type:"GET",url:n,data:e,dataType:"jsonp",jsonp:"callback",error:o,success:r})}function u(n){"undefined"!=typeof console&&console&&console.log&&console.log(n)}function s(n){return function(e,t,o){l.subscriber.xhrError.call(this,n,e,t,o)}}this.camp=null,this.name=null,this.url=null,this.interval=e||1e3,this.subscriber=n||{xhrError:function(){},notifyBegin:function(){},notifyMove:function(){},notifyRegretAsk:function(){},notifyRegretAns:function(){},notifyGameOver:function(){}};var m=null,f=null,l=this;this.setServer=function(n,e){a(n,{action:"setServer"},s("setServer"),function(t){l.url=n,u(t),e&&e()})},this.reSet=function(n){a(l.url,{action:"reSet"},s("reSet"),function(e){u(e),"ok"==e.ret&&n&&n()})},this.newGame=function(n,e,t){a(l.url,{action:"newGame",name:n},s("newGame"),function(r){u(r),"ok"==r.ret?(l.name=n,l.camp="red",o(),e&&e()):t&&t()})},this.getGames=function(n){a(l.url,{action:"getGames"},s("getGames"),function(e){u(e),n&&n(e.ret)})},this.joinGame=function(n,e,t,o){a(l.url,{action:"joinGame",name:n},s("joinGame"),function(r){u(r),"ok"==r.ret?(l.name=n,l.camp="black",i(),e&&e()):"nogame"==r.ret?t&&t():"occupy"==r.ret&&o&&o()})},this.regretAsk=function(n){a(l.url,{action:"regretAsk",name:l.name,camp:l.camp},s("regretAsk"),function(e){u(e),"ok"==e.ret&&n&&n()})},this.regretAns=function(n,e){a(l.url,{action:"regretAns",name:l.name,camp:l.camp,ans:n},s("regretAns"),function(n){u(n),"ok"==n.ret&&e&&e()})},this.move=function(n,e,t){a(l.url,{action:"move",name:l.name,camp:l.camp,posA:n,posB:e},s("move"),function(n){u(n),"ok"==n.ret&&t&&t()})},this.gameOver=function(n){a(l.url,{action:"gameOver",name:l.name},s("gameOver"),function(e){u(e),"ok"==e.ret&&(r(),c(),n&&n())})}}var t=n("jquery");return e});
//# sourceMappingURL=comm.js.map